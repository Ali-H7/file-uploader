<div class="flex justify-center">
  <% if (shares.length == 0) { %> <%- include('warning', { text: "You haven't shared any files yet" }) %> <% } else { %>
  <div class="w-2xl p-8">
    <h1 class="text-center text-xl font-bold">My Shares</h1>
    <div class="pt-4">
      <% shares.forEach((share, i)=> { %>
      <div
        class="<%=i % 2 !== 0 ? 'bg-slate-100' : 'bg-slate-200'%> flex justify-between border-2 border-slate-200 p-2 shadow-md"
      >
        <div class="flex w-full flex-col text-[clamp(0.875rem,3.7vw,1rem)] sm:flex-row">
          <% if (share.folder) { %>
          <div class="flex flex-1 items-center gap-1 truncate">
            <img src="/icons/folder.svg" alt="" />
            <a class="truncate font-bold text-blue-500 hover:underline" href="/folder/share/<%=share.folder.urlId%>">
              <p class="truncate"><%=share.folder.folderName%></p>
            </a>
          </div>
          <% } else { %>
          <div class="flex flex-1 items-center gap-1 truncate">
            <img src="/icons/file.svg" alt="" />
            <a class="truncate font-bold text-blue-500 hover:underline" href="file/<%=share.file.cloudinaryId%>">
              <p class="truncate"><%=share.file.fileName%></p>
            </a>
          </div>
          <% } %>
          <p class="pl-7 sm:w-full sm:max-w-40 sm:pl-0"><%=share.status ? `Expires ${share.status}`: 'Expired' %></p>
        </div>
        <button class="delete-dialog-button">
          <svg
            class="hover:cursor-pointer hover:fill-red-500"
            xmlns="http://www.w3.org/2000/svg"
            height="24px"
            viewBox="0 -960 960 960"
            width="24px"
            fill="#000000"
          >
            <path
              d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"
            />
          </svg>
        </button>
      </div>
      <!-- delete dialog -->
      <dialog
        class="delete-dialog fixed top-1/3 left-1/2 w-xl -translate-x-1/2 -translate-y-1/2 transform rounded-lg backdrop:bg-black/50"
      >
        <div class="flex flex-col border-2 border-slate-200 bg-slate-200 px-4 py-8 shadow-md">
          <div class="flex justify-center">
            <h1 class="font-bold"><%=share.folder ? 'Unshare Folder' : 'Unshare File'%></h1>
          </div>
          <p class="pt-2 text-center">
            Please confirm to unshare
            <span class="font-bold"><%=share.folder ? `${share.folder.folderName}` : `${share.file.fileName}`%></span>.
          </p>
          <div class="flex items-center gap-4">
            <form
              class="w-1/2"
              action="<%=!share.folder ? '/delete-share-file/' + share.id : '/delete-share-folder/' + share.id%>"
              method="post"
            >
              <button
                class="mt-4 w-full rounded-sm bg-blue-500 px-4 py-2 font-bold text-white hover:cursor-pointer hover:bg-blue-600"
              >
                Confirm
              </button>
            </form>
            <button
              class="cancel-dialog-button mt-4 w-1/2 rounded-sm bg-red-500 px-4 py-2 font-bold text-white hover:cursor-pointer hover:bg-red-600"
            >
              Cancel
            </button>
          </div>
        </div>
      </dialog>
      <% }) %>
    </div>
  </div>
  <%} %>
</div>

<script>
  const deleteDialogs = document.querySelectorAll('.delete-dialog');
  const deleteDialogButton = document.querySelectorAll('.delete-dialog-button');
  const cancelDialogButton = document.querySelectorAll('.cancel-dialog-button');
  deleteDialogs.forEach((dialog, i) => {
    deleteDialogButton[i].addEventListener('click', () => dialog.showModal());
    cancelDialogButton[i].addEventListener('click', () => dialog.close());
  });
</script>
